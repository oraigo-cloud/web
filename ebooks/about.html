<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ebook Library</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
  }
  h1 {
    text-align: center;
  }
  .folder {
    cursor: pointer;
    font-weight: bold;
    margin: 8px 0;
  }
  .folder:hover {
    color: #0077cc;
  }
  .children {
    margin-left: 20px;
    display: none;
  }
  .book-item {
    margin: 4px 0 4px 10px;
  }
  .book-item a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Ebook Library</h1>

<div id="root">Loading foldersâ€¦</div>

<script>
// GitHub repo info
const USER = "oraigo-cloud";
const REPO = "web";
const BRANCH = "main";
const ROOT_PATH = "ebooks";

// Allowed ebook extensions
const allowedExt = [".pdf", ".epub", ".mobi", ".azw3", ".txt", ".docx", ".rtf"];

const apiBase = `https://api.github.com/repos/${USER}/${REPO}/contents/`;

// Fetch directory contents
async function fetchFolder(path) {
  const url = `${apiBase}${path}?ref=${BRANCH}`;
  const response = await fetch(url);
  return await response.json();
}

// Render folder node
function createFolder(name, fullPath) {
  const folderEl = document.createElement("div");
  folderEl.className = "folder";
  folderEl.textContent = "ðŸ“ " + name;

  const childrenEl = document.createElement("div");
  childrenEl.className = "children";

  folderEl.addEventListener("click", async () => {
    if (childrenEl.dataset.loaded === "true") {
      // Toggle visibility only
      childrenEl.style.display = childrenEl.style.display === "none" ? "block" : "none";
      return;
    }

    const items = await fetchFolder(fullPath);
    childrenEl.dataset.loaded = "true";
    childrenEl.style.display = "block";

    items.forEach(item => {
      if (item.type === "dir") {
        // Create nested folder
        const subFolder = createFolder(item.name, item.path);
        childrenEl.appendChild(subFolder.container);
      }

      if (item.type === "file") {
        const ext = item.name.substring(item.name.lastIndexOf(".")).toLowerCase();

        // Skip non-ebook files
        if (!allowedExt.includes(ext)) return;

        const fileEl = document.createElement("div");
        fileEl.className = "book-item";
        fileEl.innerHTML = `<a href="${item.download_url}" target="_blank">ðŸ“˜ ${item.name}</a>`;
        childrenEl.appendChild(fileEl);
      }
    });
  });

  // container wrapper
  const container = document.createElement("div");
  container.appendChild(folderEl);
  container.appendChild(childrenEl);

  return { container };
}

// Load only subfolders of ebooks (ignore files in root)
(async () => {
  const rootEl = document.getElementById("root");
  rootEl.innerHTML = "";

  const rootItems = await fetchFolder(ROOT_PATH);

  rootItems.forEach(item => {
    if (item.type === "dir") {
      const folder = createFolder(item.name, item.path);
      rootEl.appendChild(folder.container);
    }
  });
})();
</script>

</body>
</html>
