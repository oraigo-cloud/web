<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ebook Library</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
  }
  h1 {
    text-align: center;
  }
  .folder {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
  }
  .book-item {
    padding: 10px;
    border: 1px solid #ccc;
    margin: 5px 0 5px 20px;
    background: #f9f9f9;
    border-radius: 6px;
  }
  .book-item a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Ebooks from GitHub Repo</h1>

<div id="books">Loading ebooksâ€¦</div>

<script>
// GitHub repo info
const USER = "oraigo-cloud";
const REPO = "web";
const BRANCH = "main";
const ROOT_PATH = "ebooks";

// Only allowed ebook formats
const allowedExt = [
  ".pdf", ".epub", ".mobi", ".azw3",
  ".txt", ".docx", ".rtf"
];

const apiBase = `https://api.github.com/repos/${USER}/${REPO}/contents/`;

// Recursive folder reader
async function fetchFolder(path, isRoot = false) {
  const response = await fetch(`${apiBase}${path}?ref=${BRANCH}`);
  const items = await response.json();
  const results = [];

  for (const item of items) {

    if (item.type === "dir") {
      // Recursively scan subfolders
      const sub = await fetchFolder(item.path, false);
      results.push({
        type: "folder",
        name: item.name,
        path: item.path,
        children: sub
      });
    }

    if (item.type === "file") {

      // Skip files in the root ebooks/ directory
      if (isRoot) continue;

      const ext = item.name.substring(item.name.lastIndexOf(".")).toLowerCase();
      if (!allowedExt.includes(ext)) continue;

      results.push({
        type: "file",
        name: item.name,
        url: item.download_url
      });
    }
  }
  return results;
}

// Render results
function renderItems(items, container) {
  items.forEach(item => {

    if (item.type === "folder") {
      const div = document.createElement("div");
      div.className = "folder";
      div.textContent = item.name;
      container.appendChild(div);

      const subContainer = document.createElement("div");
      subContainer.style.marginLeft = "20px";
      container.appendChild(subContainer);

      renderItems(item.children, subContainer);
    }

    if (item.type === "file") {
      const div = document.createElement("div");
      div.className = "book-item";
      div.innerHTML = `<a href="${item.url}" target="_blank">${item.name}</a>`;
      container.appendChild(div);
    }
  });
}

// Main exec
(async () => {
  const container = document.getElementById("books");
  container.innerHTML = "";

  // Root directory is scanned with isRoot = true to block its files
  const data = await fetchFolder(ROOT_PATH, true);
  renderItems(data, container);
})();
</script>

</body>
</html>
